#include <iostream>
#include <vector>
#include <algorithm>
#include <chrono>
#include <random>
#include <functional>

using namespace std;
using namespace chrono;

vector<int> generateArray(int size) {
    vector<int> arr(size);
    random_device rd;
    mt19937 gen(rd());
    uniform_int_distribution<int> dist(1, 1000000);

    for (int i = 0; i < size; i++) {
        arr[i] = dist(gen);
    }
    return arr;
}

void bubbleSort(vector<int>& arr) {
    int n = arr.size();
    for (int i = 0; i < n - 1; i++) {
        for (int j = 0; j < n - i - 1; j++) {
            if (arr[j] > arr[j + 1]) {
                swap(arr[j], arr[j + 1]);
            }
        }
    }
}

int linearSearch(const vector<int>& arr, int target) {
    for (size_t i = 0; i < arr.size(); i++) {
        if (arr[i] == target) {
            return i;
        }
    }
    return -1;
}

int binarySearch(const vector<int>& arr, int target) {
    int left = 0;
    int right = arr.size() - 1;

    while (left <= right) {
        int mid = left + (right - left) / 2;

        if (arr[mid] == target) {
            return mid;
        }
        else if (arr[mid] < target) {
            left = mid + 1;
        }
        else {
            right = mid - 1;
        }
    }
    return -1;
}

long long fibonacciRecursive(int n) {
    if (n <= 1) return n;
    return fibonacciRecursive(n - 1) + fibonacciRecursive(n - 2);
}

long long fibonacciIterative(int n) {
    if (n <= 1) return n;

    long long a = 0, b = 1, c;
    for (int i = 2; i <= n; i++) {
        c = a + b;
        a = b;
        b = c;
    }
    return b;
}

template<typename Func>
double measureTime(Func func, int iterations = 5) {
    double totalTime = 0;

    for (int i = 0; i < iterations; i++) {
        auto start = high_resolution_clock::now();
        func();
        auto end = high_resolution_clock::now();

        auto duration = duration_cast<microseconds>(end - start);
        totalTime += duration.count();
    }

    return totalTime / iterations; 

int main() {
    const int SIZE = 100000;
    const int SEARCH_TARGET = 500000; 
    const int FIBONACCI_N = 40; 

    cout << "=== Лабораторная работа: Измерение времени выполнения алгоритмов ===" << endl;
    cout << "Количество элементов массива: " << SIZE << endl;
    cout << "Количество замеров для усреднения: 5" << endl << endl;

    // Задание 1 и 2
    cout << "1. Замер времени сортировки массива из " << SIZE << " элементов:" << endl;


    vector<int> originalArray = generateArray(SIZE);

    {
        vector<int> arr = originalArray;
        double avgTime = measureTime([&arr]() {
            sort(arr.begin(), arr.end());
            });
        cout << "   - Стандартная сортировка (sort): " << avgTime / 1000 << " мс" << endl;

        vector<int> sortedArray = arr;

        // Задание 3
        cout << "\n3. Замер времени поиска элемента:" << endl;

        double avgLinearTime = measureTime([&sortedArray, SEARCH_TARGET]() {
            linearSearch(sortedArray, SEARCH_TARGET);
            });
        cout << "   - Линейный поиск: " << avgLinearTime << " мкс" << endl;

        double avgBinaryTime = measureTime([&sortedArray, SEARCH_TARGET]() {
            binarySearch(sortedArray, SEARCH_TARGET);
            });
        cout << "   - Бинарный поиск: " << avgBinaryTime << " мкс" << endl;
    }

    {
        vector<int> arr = originalArray;
        double avgTime = measureTime([&arr]() {
            bubbleSort(arr);
            });
        cout << "   - Пузырьковая сортировка: " << avgTime / 1000 << " мс" << endl;
    }

    // Задание 4
    cout << "\n4. Сравнение рекурсивной и итеративной функций (Фибоначчи n=" << FIBONACCI_N << "):" << endl;

    double avgRecursiveTime = measureTime([FIBONACCI_N]() {
        fibonacciRecursive(FIBONACCI_N);
        });
    cout << "   - Рекурсивная функция: " << avgRecursiveTime << " мкс" << endl;

    double avgIterativeTime = measureTime([FIBONACCI_N]() {
        fibonacciIterative(FIBONACCI_N);
        });
    cout << "   - Итеративная функция: " << avgIterativeTime << " мкс" << endl;

    // Задание 5
    cout << "\n5. Все измерения проведены 5 раз, показаны средние значения." << endl;
    cout << "   (Время в миллисекундах для сортировки, в микросекундах для остального)" << endl;

    return 0;
}
